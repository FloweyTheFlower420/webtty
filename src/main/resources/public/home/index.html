<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="xterm.css" />
    <script src="xterm.js"></script>
</head>
<body>
<div id="terminal"></div>
<script>
// Create WebSocket connection.
console.log("ws://" + location.hostname + ":" + location.port + "/device");
const socket = new WebSocket("ws://" + location.hostname + ":" + location.port + "/device");
//const socket = new WebSocket("ws://echo.websocket.org");
var term = new Terminal();

term.open(document.getElementById('terminal'));
term.write('Press enter to re-flush buffers\n');

//while(socket.readyState !== 1);
//console.log("connected!");

socket.addEventListener('open', function (event) {
    console.log("connected to server!");
    socket.send("{\"device\": \"test\", \"tty\": \"port1\"}");

    term.onData( (data) => {
        console.log(data);
        socket.send(data);
    });

    // Listen for messages
    socket.addEventListener('message', function (event) {
        console.log("got data: " + event.data);
        term.write(event.data);
    });
});

socket.addEventListener('close', () => {
    console.log("Closed!");
});

</script>
</body>
</html>