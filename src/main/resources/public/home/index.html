<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="xterm.css" />
    <script src="xterm.js"></script>
</head>
<body>
<div id="terminal"></div>
<script>
// Create WebSocket connection.
console.log("ws://" + location.hostname + ":" + location.port + "/device");
const socket = new WebSocket("ws://" + location.hostname + ":" + location.port + "/device");
var term = new Terminal();

term.open(document.getElementById('terminal'));
term.write('Press enter to re-flush buffers\n');

//while(socket.readyState !== 1);
//console.log("connected!");

socket.send("{\"device\": \"test\", \"tty\": \"port1\"}");

term.onData( (data) => {
    console.log(data);
    if (data.charCodeAt(0) == 13)
        socket.send('\n');
    socket.send(data);
});

// Listen for messages
socket.addEventListener('message', function (event) {
    term.write(event.data);
});
</script>
</body>
</html>